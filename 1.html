<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Private Space</title>
  <style>
    /* ‚Äî your existing styles ‚Äî */
    body { margin:0; padding:0; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; background:#fff; color:#000; text-align:center }
    h1 { font-size:3rem; font-weight:bold; margin-top:100px }
    .changing-text { display:inline-block; position:relative }
    .fade-out-in { animation:fade 1.5s ease-in-out }
    @keyframes fade { 0%{opacity:1}40%{opacity:0}60%{opacity:0}100%{opacity:1} }
    p { font-size:1.2rem; margin:20px auto 0; max-width:800px }
    button { margin-top:30px; padding:15px 25px; font-size:1rem; font-weight:bold; background:#000; color:#fff; border:none; border-radius:8px; cursor:pointer }
    .footer { margin-top:40px; font-size:1rem; color:#555 }
    .footer span { margin:0 10px }

    /* Upload Section */
    .upload-section { margin-top:100px; background:#FFEB3B; padding:60px 20px }
    .upload-box { background:#fff; max-width:600px; margin:0 auto; border-radius:16px; padding:40px 20px; box-shadow:0 10px 25px rgba(0,0,0,0.05) }
    .upload-box h2 { font-size:1.5rem; font-weight:bold; margin-bottom:10px }
    .upload-box p  { margin:0 0 30px; color:#333 }
    .upload-icon { width:80px; height:80px; margin:30px auto; border-radius:50%; background:#FFEB3B; display:flex; align-items:center; justify-content:center; border:2px dashed #000; font-size:2rem }
    .upload-buttons { display:flex; justify-content:center; gap:20px; margin-top:20px; flex-wrap:wrap }
    .upload-button { background:#fff; border:none; padding:10px 18px; border-radius:16px; font-size:1rem; box-shadow:0 5px 15px rgba(0,0,0,0.1); cursor:pointer; display:flex; align-items:center; gap:8px; color:#000; min-width:100px; justify-content:center }

    /* hide file inputs off-screen */
    .hidden-file-input { position:absolute; left:-9999px; width:0; height:0; opacity:0; overflow:hidden }
  </style>
</head>
<body>

  <!-- HERO -->
  <h1>Your Private Space for <span class="changing-text" id="dynamicWord">File-Sharing</span></h1>
  <p>Welcome to a healthier internet where you can customise your collaboration space without<br>compromising on privacy and security.</p>
  <button type="button">Discover More</button>
  <div class="footer">
    <span>Privacy preserving</span> ‚Äì <span>Open source</span> ‚Äì <span>Customizable</span>
  </div>

  <!-- UPLOAD SECTION -->
  <div class="upload-section">
    <div class="upload-box">
      <h2>Just upload and share!</h2>
      <p>You upload, you encrypt, IPFS & Arweave store.</p>
      <div class="upload-icon">üìÑ‚¨ÜÔ∏è</div>

      <!-- off-screen file inputs -->
      <input type="file" id="imageInput" accept="image/*" class="hidden-file-input">
      <input type="file" id="videoInput" accept="video/*" class="hidden-file-input">
      <input type="file" id="audioInput" accept="audio/*" class="hidden-file-input">
      <input type="file" id="genericInput" class="hidden-file-input">

      <div class="upload-buttons">
        <button type="button" class="upload-button" id="uploadImageBtn">üñºÔ∏è Image</button>
        <button type="button" class="upload-button" id="uploadVideoBtn">üé• Video</button>
        <button type="button" class="upload-button" id="uploadAudioBtn">üé§ Audio</button>
        <button type="button" class="upload-button" id="uploadGenericBtn">‚ãÆ</button>
      </div>
    </div>
  </div>

  <script type="module">
    // 1) Hero text rotation
    const words = ["File-Sharing","3D Visualization","Collaboration","Brainstorming"];
    const dyn  = document.getElementById("dynamicWord");
    let idx    = 0;
    setInterval(() => {
      dyn.classList.remove("fade-out-in"); void dyn.offsetWidth; dyn.classList.add("fade-out-in");
      idx = (idx+1) % words.length;
      setTimeout(() => dyn.textContent = words[idx], 750);
    }, 3000);

    // 2) Encryption helpers (Web Crypto)
    async function getKey() {
      return crypto.subtle.generateKey(
        { name:"AES-GCM", length:256 },
        true,
        ["encrypt","decrypt"]
      );
    }
    async function encryptBuffer(buffer, key) {
      const iv = crypto.getRandomValues(new Uint8Array(12));
      const cipher = await crypto.subtle.encrypt(
        { name:"AES-GCM", iv },
        key,
        buffer
      );
      return { iv, cipherBuffer: cipher };
    }

    // generate key once per session
    let encryptionKey;
    getKey().then(k => encryptionKey = k);

    // 3) Wire buttons ‚Üí inputs ‚Üí encrypt ‚Üí POST to backend
    function wire(btnId, inputEl) {
      document.getElementById(btnId)
        .addEventListener("click", () => inputEl.click());
      inputEl.addEventListener("change", async e => {
        const file = e.target.files[0];
        if (!file || !encryptionKey) return alert("File or key missing.");
        const buf = await file.arrayBuffer();
        const { iv, cipherBuffer } = await encryptBuffer(buf, encryptionKey);
        // prepend IV to ciphertext
        const payload = new Blob([ iv, new Uint8Array(cipherBuffer) ], { type: file.type });
        const form = new FormData();
        form.append("file", payload, file.name + ".enc");
        form.append("originalName", file.name);
        // send to your backend
        const res = await fetch("/api/upload", { method:"POST", body: form });
        const j   = await res.json();
        console.log("‚úÖ Uploaded encrypted file:", j.url);
        alert("Uploaded! URL:\n" + j.url);
      });
    }

    wire("uploadImageBtn", document.getElementById("imageInput"));
    wire("uploadVideoBtn", document.getElementById("videoInput"));
    wire("uploadAudioBtn", document.getElementById("audioInput"));
    wire("uploadGenericBtn", document.getElementById("genericInput"));
  </script>
</body>
</html>